{% extends 'navbar.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/playlist_style.css' %}">

<header class="" id="header">
    <h3 class="m-0 p-2">Try BBreaks</h3>
</header>

<main id="main" class="container-fluid row g-2 p-0 m-0">
    <!-- Modal -->
    <div class="modal fade" id="pass-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input name="playlist-password" type="password" class="form-control" id="playlist-pass"
                        required="true" placeholder="Password">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Ok</button>
                </div>
            </div>
        </div>
    </div>
    <aside id="mySidenav" class="sidenav p-2">
        <a class="hover-green" id="close-navbar" onclick="closePlaylistForm()"><i class="fa fa-close"></i></a>
        <nav id="form-wrapper">
            <form id="playlist-form" class="mt-5" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="InputTitle" class="form-label">Title</label>
                    <input name="title" type="text" class="form-control" id="InputTitle" required>
                </div>
                <div class="mb-3">
                    <label for="authorInput" class="form-label">Author</label>
                    <input name="author" type="text" class="form-control" id="authorInput" required>
                </div>
                <div class="mb-1">
                    <label for="visibility-select" class="form-label">Playlist visibility</label>
                    <select name="playlist-priv" id="visibility-select" class="form-select"
                        aria-label="Paylist visibility" onchange="disableEnablePassInput()">
                        <option value="0">Public</option>
                        <option value="1">Private</option>
                    </select>
                    <div id="pass-wrapper" class="mt-1">
                        <input name="playlist-password" type="password" class="form-control" disabled="true"
                            id="playlist-pass" required="false" placeholder="Password">
                        <a class="hover-green" onclick="seeHidePass()">
                            <i id="pass-icon" class="bi bi-eye-slash-fill"></i>
                        </a>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="formFile" class="form-label">Playlist Thumb<i
                            class="bi bi-camera-fill p-2 hover-green"></i></label>
                    <input name=" image" class="form-control" type="file" accept="image/*" required="true"
                        id="formFile">
                </div>
                <div class="input-group mb-3">
                    <label for="link-input" class="form-label col-12">Youtube Links</label>
                    <input id="link-input" type="text" class="form-control" placeholder="add a link..."
                        aria-label="Add a link">
                    <div class="input-group-append">
                        <button class="btn btn-outline-info" id="enter" type="button">Add</button>
                    </div>
                    <div class="col-12" id="links-container">
                        <ul name="music-links" class="list-group">
                        </ul>
                    </div>
                </div>
                <p id="form-errors"></p>
                <button type="submit" class="btn btn-success">Submit</button>
            </form>
        </nav>
    </aside>

    <aside class="col-12 col-md-4 col-lg-3" id="perfil-container">
        <div class="sticky-top p-2" id="menu-wrapper">
            <div class="" style="width: 100%;">
                <img class="img-fluid" id="avatar"
                    src="https://files.sunoresearch.com.br/n/uploads/2022/01/twitter-nft-bored-ape-nova-post.jpg">
            </div>
            <div class="d-grid gap-2 mt-3" id="features">
                <button type="button" class="btn btn-outline-secondary" onclick="openPlaylistForm()">New
                    Playlist</button>
                <button type="button" class="btn btn-outline-secondary">Frase do dia</button>
                <button type="button" class="btn btn-outline-secondary">FeedBacks</button>
            </div>
        </div>
    </aside>

    <article class="col-12 col-md-8 col-lg-9">
        <div class="row g-2">
            {% for playlist in playlists %}
            <div class="col-6 col-md-4 col-lg-4 card-playlist">
                <div class="card border-none" style="border: none;">
                    {% if playlist.privacy %}
                    <a href="musics/{{playlist.slug}}" data-bs-toggle="modal" data-bs-target="#pass-modal">
                        <img class="card-img-top img-fluid playlist-thumb priv" src="{{ playlist.thumb.url }}" />
                        <i id="test" class="bi bi-lock-fill"></i>
                    </a>
                    <div class="card-body p-0 mt-3">
                        <a href="musics/{{playlist.slug}}" data-bs-toggle="modal" data-bs-target="#exampleModal">
                            <p class="">{{ playlist.title | truncatechars:30 }}</p>
                        </a>
                    </div>
                    {% else %}
                    <a href="musics/{{playlist.slug}}">
                        <img class="card-img-top img-fluid playlist-thumb" src="{{ playlist.thumb.url }}" />
                    </a>
                    <div class="card-body p-0 mt-3">
                        <a href="musics/{{playlist.slug}}">
                            <p class="">{{ playlist.title | truncatechars:30 }}</p>
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </article>
</main>
<script src="{% static 'js/playlist.js' %}"></script>

{% block javascript %}
<script>
    $("#playlist-form").submit(function (e) {
        // preventing from page reload and default actions
        e.preventDefault();
        // serialize the data for sending the form data.
        let data = new FormData($('#playlist-form').get(0));
        console.log(data);
        // make POST ajax call
        $.ajax({
            type: 'POST',
            url: "{% url 'playlist-view' %}",
            data: data,
            processData: false,
            contentType: false,
            success: function (response) {
                // on successfull creating object
                // 1. clear the form.
                $("#playlist-form").trigger('reset');
                console.log("tudo certo!");
                console.log(response)
            },
            error: function (response) {
                console.log(response.responseJSON.msg);
                let errorForm = response.responseJSON.msg;
                let showErrors = document.getElementById("form-errors");
                showErrors.innerText = errorForm;

            }
        })
    })
</script>
{% endblock javascript %}

{% endblock content %}